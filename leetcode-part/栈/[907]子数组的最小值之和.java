import java.util.Deque;
import java.util.LinkedList;

////ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ Aï¼Œæ‰¾åˆ° min(B) çš„æ€»å’Œï¼Œå…¶ä¸­ B çš„èŒƒå›´ä¸º A çš„æ¯ä¸ªï¼ˆè¿ç»­ï¼‰å­æ•°ç»„ã€‚
////
//// ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œå› æ­¤è¿”å›ç­”æ¡ˆæ¨¡ 10^9 + 7ã€‚
////
////
////
//// ç¤ºä¾‹ï¼š
////
//// è¾“å…¥ï¼š[3,1,2,4]
////è¾“å‡ºï¼š17
////è§£é‡Šï¼š
////å­æ•°ç»„ä¸º [3]ï¼Œ[1]ï¼Œ[2]ï¼Œ[4]ï¼Œ[3,1]ï¼Œ[1,2]ï¼Œ[2,4]ï¼Œ[3,1,2]ï¼Œ[1,2,4]ï¼Œ[3,1,2,4]ã€‚
////æœ€å°å€¼ä¸º 3ï¼Œ1ï¼Œ2ï¼Œ4ï¼Œ1ï¼Œ1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œå’Œä¸º 17ã€‚
////
////
////
//// æç¤ºï¼š
////
////
//// 1 <= A <= 30000
//// 1 <= A[i] <= 30000
////
////
////
//// Related Topics æ ˆ æ•°ç»„
//// ğŸ‘ 136 ğŸ‘ 0
//
//
//import java.util.Stack;
//
////leetcode submit region begin(Prohibit modification and deletion)
class Solution {

    /**
     * æ€è·¯1ï¼šå•è°ƒæ ˆã€‚
     * éå†æ‰€æœ‰ç»„åˆçš„æ€è·¯ï¼šä»¥A[]æ•°ç»„ä¸­æ¯ä¸ªä½ç½®içš„æ•°å­—åšç»“å°¾ï¼Œå…¶å¯¹åº”ä»0~iå¼€å§‹ï¼›
     * æ‰€æœ‰çš„ç»“å°¾éå†ä¸€éï¼Œå³ä¸ºæ‰€æœ‰çš„å­æ•°ç»„ç»„åˆã€‚
     * æŒ‰ç…§ç»“å°¾é©±åŠ¨çš„æ–¹å¼ï¼Œé€šè¿‡ç»“å°¾indexè¿›è¡Œéå†ã€‚
     * ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œæ ˆä¸­çš„æ•°æ®æ˜¯é€’å¢çš„ï¼Œåœ¨å¯¹ç»“å°¾indexè¿›è¡Œéå†çš„è¿‡ç¨‹ä¸­ï¼Œä¾æ¬¡
     * åŠ å…¥æ›´å¤§çš„å…ƒç´ ï¼Œè¡¨ç¤ºå¼€å§‹çš„ä½ç½®æœ‰å¤šé å‰ï¼Œå½“å‰å­æ•°ç»„çš„æœ€å°å€¼æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚
     * è¿›è€Œå¯ä»¥ç»Ÿè®¡å‡ºæ¯ä¸ªç»“å°¾indexå¯¹åº”çš„æ‰€æœ‰å¯èƒ½çš„å­æ•°ç»„ï¼Œæ‰€å¯¹åº”çš„æœ€å°å€¼ä¹‹å’Œã€‚
     * å‰ä¸€ä¸ªç»“å°¾indexçš„æœ€å°å€¼ä¹‹å’Œä¸åä¸€ä¸ªç»“å°¾indexçš„æœ€å°å€¼ä¹‹å’Œæ˜¯æœ‰å…³è”çš„ï¼Œé€šè¿‡temp
     * å˜é‡è¿›è¡Œå­˜å‚¨ã€‚
     *
     */
    private int MOD = 1_000_000_007;

    public int sumSubarrayMins(int[] A) {
        int len = A.length;
        Deque<Pair> stack = new LinkedList<>(); // å•è°ƒæ ˆ
        int result = 0, temp = 0;
        for (int i = 0; i < len; i++) {
            int count = 1; // å­æ•°ç»„ä»¥iç»“å°¾æ—¶ï¼Œå•è°ƒæ ˆæ ˆé¡¶å¯¹åº”çš„minå€¼ä¸€å…±ä¼šå‡ºç°åœ¨å‡ ä¸ªå­æ•°ç»„ä¸­
            while (!stack.isEmpty() && stack.peek().val >= A[i]) {
                Pair pop = stack.pop(); // æ ˆé¡¶éœ€è¦æ›´æ–°ï¼Œå› ä¸ºiä½ç½®çš„å€¼æ¯”æ ˆé¡¶è¿˜è¦å°
                count += pop.count; // æŠŠtempä¸­å†—ä½™çš„éƒ¨åˆ†åˆ æ‰
                temp -= pop.val * pop.count;
            }
            stack.push(new Pair(A[i], count));
            temp += A[i] * count; // temp æ›´æ–°ä¸ºæ ˆæ›´æ–°åçš„å€¼
            result += temp;
            result %= MOD;
        }

        return result;
    }
}

class Pair {
    public int val;
    public int count; // å¯¹å­æ•°ç»„ä¸ªæ•°è®¡æ•°

    public Pair(int val, int count) {
        this.val = val;
        this.count = count;
    }
}



////leetcode submit region end(Prohibit modification and deletion)
